@model STAREvents.Web.ViewModels.Events.EventsViewModel

@{
    ViewData["Title"] = "All Events";
}

@section Styles {
    <link rel="stylesheet" href="~/css/all.css" asp-append-version="true" />
}

<h3 class="text-center display-4 py-3 fw-bold">All Events</h3>

<form method="get" asp-controller="Events" asp-action="All" class="filter-form">
    <input type="text" name="searchTerm" value="@Model.SearchTerm" placeholder="Search events..." class="form-control" />
    <select name="selectedCategory" class="form-control category-select" asp-for="SelectedCategory" asp-items="@(new SelectList(Model.Categories, "CategoryID", "Name", Model.SelectedCategory))" onchange="this.form.submit()">
        <option value="">All Categories</option>
    </select>
</form>

@if (Model.Events == null || !Model.Events.Any())
{
    <p class="text-center display-4 my-5">No events available.</p>
}
else
{
    <div class="row">
        @foreach (var eventItem in Model.Events)
        {
            <div class="col-md-4 mb-4">
                <div class="card">
                    <img src="@eventItem.ImageUrl" class="card-img-top" alt="@eventItem.Name" />
                    <div class="card-body">
                        <h5 class="card-title">@eventItem.Name</h5>
                        <p class="card-text">@eventItem.Description</p>
                        <p class="card-text"><small class="text-muted">@eventItem.StartDate.ToString("g") - @eventItem.EndDate.ToString("g")</small></p>
                        <p class="card-text"><small class="text-muted">Category: @eventItem.Category.Name</small></p>
                        <p class="card-text"><small class="text-muted">Capacity: @eventItem.Capacity</small></p>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="pagination">
        @if (Model.CurrentPage > 1)
        {
            <a asp-action="All" asp-route-page="@(Model.CurrentPage - 1)" asp-route-searchTerm="@Model.SearchTerm" asp-route-selectedCategory="@Model.SelectedCategory" asp-route-sortOption="@Model.SortOption">Previous</a>
        }

        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <a asp-action="All" asp-route-page="@i" asp-route-searchTerm="@Model.SearchTerm" asp-route-selectedCategory="@Model.SelectedCategory" asp-route-sortOption="@Model.SortOption" class="@(i == Model.CurrentPage ? "active" : "")">@i</a>
        }

        @if (Model.CurrentPage < Model.TotalPages)
        {
            <a asp-action="All" asp-route-page="@(Model.CurrentPage + 1)" asp-route-searchTerm="@Model.SearchTerm" asp-route-selectedCategory="@Model.SelectedCategory" asp-route-sortOption="@Model.SortOption">Next</a>
        }
    </div>
}
